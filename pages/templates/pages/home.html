{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "North Cyprus Real Estate — Invest & Live" %}{% endblock %}
{% block content %}

<style>
  .hero{display:grid;gap:18px;grid-template-columns:1.2fr 1fr;align-items:center}
  .hero-card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:22px}
  .hero h1{font-size:2.2rem;line-height:1.15;margin:0}
  .hero p{color:var(--muted);margin:.4rem 0 1rem}
  .hero .badges{display:flex;gap:12px;flex-wrap:wrap;color:#0b3b5a}
  .badge{background:#e6f4ff;color:#0b3b5a;border:1px solid #cae6ff;border-radius:999px;padding:6px 10px;font-weight:700}
  .hero-cta{display:grid;gap:10px}
  .cta-mini{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:16px}
  .cta-mini h3{margin:.2rem 0 .6rem}
  .cta-mini form{display:grid;grid-template-columns:1fr;gap:10px}
  .cta-mini input{padding:10px 12px;border:1px solid var(--line);border-radius:10px}
  .cta-mini input:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 3px rgba(11,106,168,.16)}
  @media (max-width:980px){.hero{grid-template-columns:1fr}}

  .cta-form{
    display:grid;
    grid-template-columns:1fr 1fr auto;
    gap:10px;
    align-items:stretch;
  }
  @media (max-width:700px){ .cta-form{ grid-template-columns:1fr; } }

  .input,
  .hero-card input[type="text"],
  .hero-card input[type="tel"],
  .hero-card input[type="email"],
  .hero-card input[type="search"]{
    width:100%;
    height:44px;
    box-sizing:border-box;
    padding:10px 12px;
    background:#fff;
    border:1px solid var(--line);
    border-radius:10px;
    font:inherit; color:var(--ink);
    box-shadow:0 1px 0 rgba(2,8,23,.02);
    transition:border-color .15s ease, box-shadow .15s ease;
  }
  .input:focus,
  .hero-card input:focus{
    outline:none;
    border-color:var(--brand);
    box-shadow:0 0 0 3px rgba(11,106,168,.16);
  }
  .input::placeholder{ color:#7b8794; }

  .cta-form .btn{
    height:44px;
    padding:0 18px;
    border-radius:10px;
    display:inline-flex;align-items:center;justify-content:center;
  }

  .calc{margin-top:26px;display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media (max-width:980px){.calc{grid-template-columns:1fr}}
  .panel{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:18px}
  .panel h3{margin:.2rem 0 .6rem}
  .calc-row{display:grid;gap:10px}
  .calc-row label{font-weight:600;color:var(--muted)}
  .calc-row input[type="range"]{width:100%}
  .calc-grid{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end}
  .ccy-select{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
  .out{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px}
  .pill{background:#f4f7fb;border:1px solid #e7edf5;border-radius:12px;padding:10px 12px}
  .pill b{display:block;font-size:1.2rem}

  .cases{margin-top:26px}
  .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  @media (max-width:980px){.cards{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:14px}
  .card h4{margin:.3rem 0}
  .meta{color:var(--muted);font-size:.95rem}

  /* ===== FAQ (keep your look; add smooth animation only) ===== */
  .faq{margin-top:26px}
  .faq-item{border:1px solid var(--line);border-radius:12px;background:#fff;margin-bottom:10px}
  .faq-q{display:flex;justify-content:space-between;gap:12px;padding:12px 14px;cursor:pointer;font-weight:700}

  /* was: .faq-a{display:none} & .faq-item.open .faq-a{display:block} */
  .faq-a{padding:0 14px 12px;color:var(--muted);}

  /* animation helpers */
  .faq .faq-a{display:block!important;overflow:hidden;max-height:0;opacity:0;transition:max-height .35s ease, opacity .35s ease;}
  .faq .faq-item.is-open .faq-a{opacity:1;}
  .faq .faq-q span:last-child{display:inline-block;transition:transform .25s ease;}
  .faq .faq-item.is-open .faq-q span:last-child{transform:rotate(45deg);}
</style>

<section class="hero">
  <div>
    <h1>{% trans "Real estate in North Cyprus" %}</h1>
    <p>{% trans "Affordable Mediterranean living and strong investment potential with developer installment plans up to 84 months at 0%." %}</p>
    <div class="badges">
      <span class="badge">{% trans "Deal in 3 days" %}</span>
      <span class="badge">{% trans "Residence permit help" %}</span>
      <span class="badge">{% trans "Post-sale service" %}</span>
    </div>
  </div>

  <div class="hero-card hero-cta">
    <h3>{% trans "Get a free consultation" %}</h3>
    <p class="meta">{% trans "Leave your contacts — our advisor will get back to you." %}</p>

    {% if form %}
      <form method="post" action="{% url 'leads:contact' %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-primary" type="submit">{% trans "Send" %}</button>
      </form>
    {% else %}
      <form method="get" action="{% url 'leads:contact' %}" class="cta-form">
        <input class="input" name="name"  placeholder="{% trans 'Your name' %}" type="text">
        <input class="input" name="phone" placeholder="{% trans 'Phone / WhatsApp' %}" type="tel">
        <button class="btn btn-primary" type="submit">{% trans "Request Info" %}</button>
      </form>
    {% endif %}
  </div>
</section>

<section class="calc">
  <div class="panel">
    <h3>{% trans "Installment calculator" %}</h3>

    <div class="calc-row">
      <div class="calc-grid">
        <div>
          <label for="price">{% trans "Price" %} (<span id="ccyLabel">GBP</span>)</label>
          <input id="price" type="range" min="50000" max="500000" step="500" value="150000" />
          <div class="meta"><span id="priceVal">£150,000</span></div>
        </div>

        <div>
          <label for="ccy">{% trans "Currency" %}</label>
          <select id="ccy" class="ccy-select" aria-label="{% trans 'Currency' %}">
            <option value="GBP" selected>GBP (£)</option>
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (€)</option>
            <option value="TRY">TRY (₺)</option>
            <option value="RUB">RUB (₽)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="out">
      <div class="pill">
        <span class="meta">{% trans "Down payment (30%)" %}</span>
        <b id="dp">£45,000</b>
      </div>
      <div class="pill">
        <span class="meta">{% trans "Monthly (70% / 84 mo)" %}</span>
        <b id="mo">£1,250</b>
      </div>
    </div>
  </div>

  <div class="panel">
    <h3>{% trans "Featured project" %}</h3>
    <p class="meta">{% trans "Sea-side resort complex — from £92,000" %}</p>
    <a class="btn btn-primary" href="{% url 'properties:list' %}">{% trans "See projects" %}</a>
  </div>
</section>

<section class="cases">
  <h3>{% trans "Reviews & growth from past deals" %}</h3>
  <div class="cards">
    <article class="card">
      <h4>{% trans "1+1 Apartment in resort" %}</h4>
      <div class="meta">{% trans "Buy: £56,000 (2019) → Market: £172,200 (2023)" %}</div>
      <p>{% trans "Client review placeholder — short testimonial." %}</p>
    </article>
    <article class="card">
      <h4>{% trans "3+1 Villa, Yeni Boazici" %}</h4>
      <div class="meta">{% trans "Buy: £159,000 (2020) → Market: £480,000 (2023)" %}</div>
      <p>{% trans "Client review placeholder — short testimonial." %}</p>
    </article>
    <article class="card">
      <h4>{% trans "2+1 Apartment in tourist complex" %}</h4>
      <div class="meta">{% trans "Buy: £146,000 (2022) → Market: £260,000 (2023)" %}</div>
      <p>{% trans "Client review placeholder — short testimonial." %}</p>
    </article>
  </div>
</section>

<section class="faq">
  <h3>{% trans "FAQ" %}</h3>
  <div class="faq-item">
    <div class="faq-q">{% trans "What is the free inspection tour?" %}<span>＋</span></div>
    <div class="faq-a">{% trans "We host you in seaside apartments for several days and visit matching projects together." %}</div>
  </div>
  <div class="faq-item">
    <div class="faq-q">{% trans "Can I buy remotely?" %}<span>＋</span></div>
    <div class="faq-a">{% trans "Yes — we arrange an online tour and a secure developer contract with couriered originals." %}</div>
  </div>
  <div class="faq-item">
    <div class="faq-q">{% trans "What extra costs are there?" %}<span>＋</span></div>
    <div class="faq-a">{% trans "Stamp duty, title tax, utilities connection; VAT 5%; maintenance depends on the developer." %}</div>
  </div>
</section>

<script>
  // Currency-aware calculator: internal base = GBP
  (function(){
    const FX = {
      GBP: { rate: 1.00, symbol: "£", label: "GBP" },
      USD: { rate: 1.27, symbol: "$", label: "USD" },
      EUR: { rate: 1.18, symbol: "€", label: "EUR" },
      TRY: { rate: 41.00, symbol: "₺", label: "TRY" },
      RUB: { rate: 112.00, symbol: "₽", label: "RUB" }
    };
    const price = document.getElementById('price');
    const priceVal = document.getElementById('priceVal');
    const dp = document.getElementById('dp');
    const mo = document.getElementById('mo');
    const ccy = document.getElementById('ccy');
    const ccyLabel = document.getElementById('ccyLabel');

    function fmt(symbol, n){ return symbol + Number(n).toLocaleString(); }
    function recalc(){
      const base = parseInt(price.value || 0, 10);
      const fx = FX[ccy.value] || FX.GBP;
      const priceOut = base * fx.rate;
      const dpOut = base * 0.30 * fx.rate;
      const moOut = (base * 0.70 / 84) * fx.rate;
      ccyLabel.textContent = fx.label;
      priceVal.textContent = fmt(fx.symbol, priceOut.toFixed(0));
      dp.textContent = fmt(fx.symbol, dpOut.toFixed(0));
      mo.textContent = fmt(fx.symbol, moOut.toFixed(0));
    }
    price.addEventListener('input', recalc);
    ccy.addEventListener('change', recalc);
    recalc();
  })();

  /* ===== Smooth FAQ accordion (no visual restyle) ===== */
  (function () {
    const faq = document.querySelector('.faq');
    if (!faq) return;

    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    faq.querySelectorAll('.faq-item').forEach((item) => {
      const q = item.querySelector('.faq-q');
      const a = item.querySelector('.faq-a');
      if (!q || !a) return;

      // start collapsed
      a.style.maxHeight = '0px';
      a.style.opacity = '0';

      function open() {
        item.classList.add('is-open');
        a.style.opacity = '1';
        a.style.maxHeight = a.scrollHeight + 'px';
        if (prefersReduced) {
          a.style.maxHeight = 'none';
        } else {
          const done = () => {
            if (item.classList.contains('is-open')) a.style.maxHeight = 'none';
            a.removeEventListener('transitionend', done);
          };
          a.addEventListener('transitionend', done);
        }
      }

      function close() {
        item.classList.remove('is-open');
        if (a.style.maxHeight === 'none') {
          a.style.maxHeight = a.scrollHeight + 'px';
          void a.offsetHeight; // force reflow
        }
        a.style.opacity = '0';
        a.style.maxHeight = '0px';
      }

      q.addEventListener('click', () => {
        if (item.classList.contains('is-open')) close();
        else {
          if (a.style.maxHeight === 'none') {
            a.style.maxHeight = '0px';
            void a.offsetHeight;
          }
          open();
        }
      });
    });
  })();
</script>
{% endblock %}
